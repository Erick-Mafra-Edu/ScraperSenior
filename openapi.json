{
  "openapi": "3.1.0",
  "info": {
    "title": "Senior Documentation MCP HTTP Server",
    "description": "Servidor MCP (Model Context Protocol) via HTTP para busca de documentação Senior. Implementa protocolo MCP 2025-06-18 com suporte a JSON-RPC 2.0 e Server-Sent Events (SSE).\n\n## Como Usar\n\n1. **Inicializar**: Envie POST /mcp com method='initialize' para criar sessão\n2. **Listar Ferramentas**: Envie POST /mcp com method='tools/list' para ver operações disponíveis\n3. **Buscar Documentos**: Envie POST /mcp com method='tools/call' para executar 'search_docs'\n\n## Ferramentas Disponíveis\n\n- **search_docs**: Busca documentos por palavras-chave com parsing inteligente\n- **list_modules**: Lista todos os módulos/categorias de documentação\n- **get_module_docs**: Retorna documentos de um módulo específico\n- **get_stats**: Estatísticas da base de documentação\n\n## Exemplo de Uso\n\n```bash\n# Buscar documentos sobre \"funções lsp\"\ncurl -X POST http://localhost:8000/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"tools/call\",\n    \"params\": {\n      \"name\": \"search_docs\",\n      \"arguments\": {\n        \"query\": \"funções lsp\",\n        \"limit\": 5,\n        \"query_strategy\": \"auto\"\n      }\n    }\n  }'\n```",
    "version": "1.0.0",
    "contact": {
      "name": "Senior Documentation"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Local development server"
    },
    {
      "url": "http://people-fy.com:8000",
      "description": "Production server"
    }
  ],
  "paths": {
    "/mcp": {
      "post": {
        "summary": "MCP JSON-RPC 2.0 Endpoint",
        "description": "Endpoint principal para comunicação MCP. Aceita requisições JSON-RPC 2.0.\n\n**Métodos Disponíveis:**\n- `initialize`: Inicializar sessão MCP\n- `tools/list`: Listar ferramentas disponíveis\n- `tools/call`: Executar uma ferramenta\n\n**Accept Headers:**\n- `application/json`: Resposta JSON simples\n- `text/event-stream`: Resposta em Server-Sent Events (streaming)",
        "operationId": "mcp_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JsonRpcRequest"
              },
              "examples": {
                "initialize": {
                  "summary": "Inicializar MCP",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 1,
                    "method": "initialize",
                    "params": {}
                  }
                },
                "list_tools": {
                  "summary": "Listar ferramentas",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 2,
                    "method": "tools/list",
                    "params": {}
                  }
                },
                "search_docs": {
                  "summary": "Buscar documentos",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 3,
                    "method": "tools/call",
                    "params": {
                      "name": "search_docs",
                      "arguments": {
                        "query": "funções lsp",
                        "limit": 5,
                        "query_strategy": "auto"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sucesso - Resposta JSON-RPC 2.0",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JsonRpcResponse"
                }
              },
              "text/event-stream": {
                "schema": {
                  "$ref": "#/components/schemas/JsonRpcResponse"
                }
              }
            }
          },
          "400": {
            "description": "Erro na requisição JSON-RPC"
          },
          "405": {
            "description": "GET streaming não suportado"
          }
        }
      },
      "get": {
        "summary": "SSE Stream (Não Suportado)",
        "description": "Endpoint para abrir stream SSE. Atualmente não suportado neste servidor.",
        "operationId": "mcp_get",
        "responses": {
          "405": {
            "description": "Method Not Allowed - GET streaming not supported"
          }
        }
      },
      "delete": {
        "summary": "Encerrar Sessão",
        "description": "Encerra uma sessão MCP identificada pelo header Mcp-Session-Id.",
        "operationId": "mcp_delete",
        "parameters": [
          {
            "name": "Mcp-Session-Id",
            "in": "header",
            "required": true,
            "description": "ID da sessão a encerrar",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sessão encerrada com sucesso"
          },
          "404": {
            "description": "Sessão não encontrada"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "description": "Suporta CORS preflight requests",
        "operationId": "mcp_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Verifica se o servidor está respondendo e saudável.",
        "operationId": "health_get",
        "responses": {
          "200": {
            "description": "Servidor saudável",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                },
                "example": {
                  "status": "healthy",
                  "service": "Senior Documentation MCP HTTP",
                  "version": "1.0.0",
                  "timestamp": "2026-02-05T12:34:56.789012"
                }
              }
            }
          }
        }
      }
    },
    "/openapi.json": {
      "get": {
        "summary": "OpenAPI Schema",
        "description": "Retorna esta especificação OpenAPI em formato JSON.",
        "operationId": "openapi_schema",
        "responses": {
          "200": {
            "description": "OpenAPI 3.1.0 schema"
          }
        }
      }
    },
    "/api/search": {
      "get": {
        "tags": ["REST API - Search"],
        "summary": "Pesquisar Documentação (REST)",
        "description": "Endpoint REST simples para buscar documentação. Alternativa mais fácil ao JSON-RPC para integrações com Open WebUI e ferramentas web.",
        "operationId": "api_search_get",
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": true,
            "description": "Termo(s) de busca",
            "schema": {
              "type": "string",
              "example": "configurar LSP"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "description": "Máximo de resultados (padrão: 5, máximo: 100)",
            "schema": {
              "type": "integer",
              "default": 5,
              "minimum": 1,
              "maximum": 100
            }
          },
          {
            "name": "module",
            "in": "query",
            "required": false,
            "description": "Filtrar por módulo específico (ex: 'Help Center')",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "strategy",
            "in": "query",
            "required": false,
            "description": "Estratégia de parsing: 'auto' (recomendado), 'quoted', 'and'",
            "schema": {
              "type": "string",
              "enum": ["auto", "quoted", "and"],
              "default": "auto"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Busca realizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"],
                      "description": "Status da requisição"
                    },
                    "query": {
                      "type": "string",
                      "description": "Query original"
                    },
                    "parsed_query": {
                      "type": "string",
                      "description": "Query após transformação"
                    },
                    "strategy": {
                      "type": "string",
                      "description": "Estratégia usada"
                    },
                    "module_filter": {
                      "type": ["string", "null"],
                      "description": "Filtro de módulo aplicado"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Número de resultados"
                    },
                    "results": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/DocumentResult"
                      }
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "query": "configurar LSP",
                  "parsed_query": "\"configurar LSP\"",
                  "strategy": "auto",
                  "module_filter": null,
                  "count": 3,
                  "results": [
                    {
                      "title": "Configurar LSP",
                      "url": "https://...",
                      "module": "Help Center",
                      "content": "Instruções para configurar..."
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Parâmetro 'query' obrigatório"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_search_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/modules": {
      "get": {
        "tags": ["REST API - Modules"],
        "summary": "Listar Módulos (REST)",
        "description": "Retorna lista de todos os módulos/categorias de documentação disponíveis.",
        "operationId": "api_modules_get",
        "responses": {
          "200": {
            "description": "Lista de módulos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "total_modules": {
                      "type": "integer",
                      "description": "Total de módulos"
                    },
                    "modules": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de nomes de módulos"
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "total_modules": 12,
                  "modules": [
                    "Help Center",
                    "Release Notes",
                    "API Documentation"
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_modules_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/modules/{module_name}": {
      "get": {
        "tags": ["REST API - Modules"],
        "summary": "Obter Documentos de Módulo (REST)",
        "description": "Retorna todos os documentos de um módulo específico.",
        "operationId": "api_module_docs_get",
        "parameters": [
          {
            "name": "module_name",
            "in": "path",
            "required": true,
            "description": "Nome do módulo",
            "schema": {
              "type": "string",
              "example": "Help Center"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "description": "Máximo de documentos (padrão: 20, máximo: 100)",
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Documentos do módulo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "module": {
                      "type": "string",
                      "description": "Nome do módulo"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Número de documentos"
                    },
                    "docs": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/DocumentResult"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Nome do módulo inválido"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_module_docs_options",
        "parameters": [
          {
            "name": "module_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/stats": {
      "get": {
        "tags": ["REST API - Statistics"],
        "summary": "Estatísticas da Base (REST)",
        "description": "Retorna estatísticas sobre a base de documentação indexada.",
        "operationId": "api_stats_get",
        "responses": {
          "200": {
            "description": "Estatísticas da documentação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "data": {
                      "type": "object",
                      "description": "Dados estatísticos",
                      "properties": {
                        "total_documents": {
                          "type": "integer"
                        },
                        "total_modules": {
                          "type": "integer"
                        },
                        "indexed_date": {
                          "type": "string",
                          "format": "date"
                        },
                        "index_size": {
                          "type": "string",
                          "description": "Tamanho do índice em MB"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "data": {
                    "total_documents": 10456,
                    "total_modules": 12,
                    "indexed_date": "2026-02-05",
                    "index_size": "45.3 MB"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_stats_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "JsonRpcRequest": {
        "type": "object",
        "title": "JSON-RPC 2.0 Request",
        "description": "Requisição no formato JSON-RPC 2.0 conforme https://www.jsonrpc.org/specification",
        "required": ["jsonrpc", "method", "id"],
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": ["2.0"],
            "description": "Versão JSON-RPC"
          },
          "method": {
            "type": "string",
            "description": "Método a executar: 'initialize', 'tools/list', 'tools/call'",
            "enum": ["initialize", "tools/list", "tools/call"]
          },
          "params": {
            "type": "object",
            "description": "Parâmetros do método"
          },
          "id": {
            "type": ["string", "number"],
            "description": "ID único da requisição (retornado na resposta)"
          }
        }
      },
      "JsonRpcResponse": {
        "type": "object",
        "title": "JSON-RPC 2.0 Response",
        "description": "Resposta no formato JSON-RPC 2.0",
        "required": ["jsonrpc", "id"],
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": ["2.0"]
          },
          "id": {
            "type": ["string", "number"],
            "description": "ID da requisição correspondente"
          },
          "result": {
            "type": "object",
            "description": "Resultado da operação (se sucesso)"
          },
          "error": {
            "$ref": "#/components/schemas/JsonRpcError"
          }
        }
      },
      "JsonRpcError": {
        "type": "object",
        "title": "JSON-RPC 2.0 Error",
        "required": ["code", "message"],
        "properties": {
          "code": {
            "type": "integer",
            "description": "Código do erro JSON-RPC"
          },
          "message": {
            "type": "string",
            "description": "Mensagem de erro"
          },
          "data": {
            "type": "object",
            "description": "Dados adicionais do erro"
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "title": "Health Check Response",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy"],
            "description": "Status do serviço"
          },
          "service": {
            "type": "string",
            "description": "Nome do serviço"
          },
          "version": {
            "type": "string",
            "description": "Versão do serviço"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da resposta"
          }
        }
      },
      "SearchDocsRequest": {
        "type": "object",
        "title": "Search Docs Request",
        "description": "Parâmetros para ferramenta search_docs",
        "required": ["query"],
        "properties": {
          "query": {
            "type": "string",
            "description": "Palavras-chave para busca",
            "example": "funções lsp"
          },
          "module": {
            "type": "string",
            "description": "Filtrar por módulo específico (opcional)",
            "example": "Help Center"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 5,
            "description": "Máximo de resultados a retornar"
          },
          "query_strategy": {
            "type": "string",
            "enum": ["quoted", "and", "auto"],
            "default": "auto",
            "description": "Estratégia de parsing de query:\n- 'quoted': Envolver em aspas para frase exata\n- 'and': Usar AND entre termos\n- 'auto': Inteligente (recomendado)"
          }
        }
      },
      "SearchDocsResponse": {
        "type": "object",
        "title": "Search Docs Response",
        "properties": {
          "query": {
            "type": "string",
            "description": "Query original"
          },
          "parsed_query": {
            "type": "string",
            "description": "Query após parsing"
          },
          "query_strategy": {
            "type": "string",
            "description": "Estratégia usada"
          },
          "module_filter": {
            "type": ["string", "null"],
            "description": "Filtro de módulo aplicado"
          },
          "count": {
            "type": "integer",
            "description": "Número de resultados encontrados"
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Título do documento"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL do documento"
                },
                "module": {
                  "type": "string",
                  "description": "Módulo/categoria do documento"
                },
                "content": {
                  "type": "string",
                  "description": "Conteúdo resumido do documento"
                }
              }
            }
          }
        }
      },
      "Tool": {
        "type": "object",
        "title": "MCP Tool",
        "description": "Definição de uma ferramenta disponível no MCP",
        "properties": {
          "name": {
            "type": "string",
            "description": "Nome único da ferramenta"
          },
          "description": {
            "type": "string",
            "description": "Descrição do que a ferramenta faz"
          },
          "inputSchema": {
            "type": "object",
            "description": "Schema JSON dos parâmetros de entrada"
          }
        }
      },
      "DocumentResult": {
        "type": "object",
        "title": "Document Result",
        "description": "Resultado de um documento da busca",
        "properties": {
          "title": {
            "type": "string",
            "description": "Título do documento"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL do documento"
          },
          "module": {
            "type": "string",
            "description": "Módulo/categoria do documento"
          },
          "content": {
            "type": "string",
            "description": "Conteúdo resumido do documento"
          },
          "summary": {
            "type": "string",
            "description": "Resumo do documento"
          }
        }
      }
    },
    "headers": {
      "MCP-Session-Id": {
        "schema": {
          "type": "string",
          "format": "uuid"
        },
        "description": "ID da sessão MCP (obtido em response de initialize)"
      },
      "MCP-Protocol-Version": {
        "schema": {
          "type": "string",
          "default": "2025-06-18"
        },
        "description": "Versão do protocolo MCP"
      }
    }
  },
  "tags": [
    {
      "name": "MCP Protocol",
      "description": "Operações do protocolo Model Context Protocol"
    },
    {
      "name": "Documentation Search",
      "description": "Ferramentas para busca de documentação"
    },
    {
      "name": "Health & Status",
      "description": "Health checks e status do servidor"
    },
    {
      "name": "REST API - Search",
      "description": "Endpoints REST simples para busca de documentação"
    },
    {
      "name": "REST API - Modules",
      "description": "Endpoints REST para gerenciar módulos de documentação"
    },
    {
      "name": "REST API - Statistics",
      "description": "Endpoints REST para estatísticas da base de documentação"
    }
  ]
}
