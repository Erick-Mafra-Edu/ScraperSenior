{
  "openapi": "3.1.0",
  "info": {
    "title": "Senior Documentation MCP HTTP Server",
    "description": "Servidor MCP (Model Context Protocol) via HTTP para busca de documentação Senior. Implementa protocolo MCP 2025-06-18 com suporte a JSON-RPC 2.0 e Server-Sent Events (SSE).\n\n## Compatibilidade com LLM/Open WebUI\n\nEste servidor foi otimizado para integração com agentes de IA (LLMs) no Open WebUI:\n- **REST API Endpoints** (/api/*): Interface simples via GET HTTP para LLMs consumirem\n- **Query Parsing Inteligente**: Estratégias auto/quoted/and para refinar buscas\n- **Schemas Detalhados**: Respostas estruturadas com DocumentSummary, SearchResult, etc.\n- **CORS Habilitado**: Permite chamadas diretas do navegador e Open WebUI\n\n## Como Usar\n\n### Via JSON-RPC (Full MCP Protocol)\n1. **Inicializar**: Envie POST /mcp com method='initialize' para criar sessão\n2. **Listar Ferramentas**: Envie POST /mcp com method='tools/list' para ver operações disponíveis\n3. **Buscar Documentos**: Envie POST /mcp com method='tools/call' para executar 'search_docs'\n\n### Via REST API (Recomendado para LLMs)\n1. **Buscar**: GET /api/search?query=...&strategy=auto\n2. **Explorar Módulos**: GET /api/modules\n3. **Listar Docs do Módulo**: GET /api/modules/{nome}?limit=20\n4. **Obter Documento Completo**: GET /api/document/{doc_id}\n\n## Ferramentas Disponíveis\n\n- **search_docs**: Busca documentos por palavras-chave com parsing inteligente\n- **list_modules**: Lista todos os módulos/categorias de documentação\n- **get_module_docs**: Retorna documentos de um módulo específico\n- **get_stats**: Estatísticas da base de documentação\n\n## Exemplo de Uso (REST - Recomendado para LLMs)\n\n```bash\n# Buscar documentos sobre \"funções lsp\" com estratégia automática\ncurl \"http://localhost:8000/api/search?query=funções+lsp&strategy=auto&limit=5\"\n\n# Resposta estruturada com DocumentSummary de cada resultado\n# Use /api/document/{id} para obter o conteúdo completo se necessário\n```",
    "version": "1.0.0",
    "contact": {
      "name": "Senior Documentation"
    },
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8000",
      "description": "Local development server"
    },
    {
      "url": "http://people-fy.com:8000",
      "description": "Production server"
    }
  ],
  "paths": {
    "/mcp": {
      "post": {
        "summary": "MCP JSON-RPC 2.0 Endpoint",
        "description": "Endpoint principal para comunicação MCP. Aceita requisições JSON-RPC 2.0.\n\n**Métodos Disponíveis:**\n- `initialize`: Inicializar sessão MCP\n- `tools/list`: Listar ferramentas disponíveis\n- `tools/call`: Executar uma ferramenta\n\n**Accept Headers:**\n- `application/json`: Resposta JSON simples\n- `text/event-stream`: Resposta em Server-Sent Events (streaming)",
        "operationId": "mcp_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JsonRpcRequest"
              },
              "examples": {
                "initialize": {
                  "summary": "Inicializar MCP",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 1,
                    "method": "initialize",
                    "params": {}
                  }
                },
                "list_tools": {
                  "summary": "Listar ferramentas",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 2,
                    "method": "tools/list",
                    "params": {}
                  }
                },
                "search_docs": {
                  "summary": "Buscar documentos",
                  "value": {
                    "jsonrpc": "2.0",
                    "id": 3,
                    "method": "tools/call",
                    "params": {
                      "name": "search_docs",
                      "arguments": {
                        "query": "funções lsp",
                        "limit": 5,
                        "query_strategy": "auto"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sucesso - Resposta JSON-RPC 2.0",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/JsonRpcResponse"
                }
              },
              "text/event-stream": {
                "schema": {
                  "$ref": "#/components/schemas/JsonRpcResponse"
                }
              }
            }
          },
          "400": {
            "description": "Erro na requisição JSON-RPC"
          },
          "405": {
            "description": "GET streaming não suportado"
          }
        }
      },
      "get": {
        "summary": "SSE Stream (Não Suportado)",
        "description": "Endpoint para abrir stream SSE. Atualmente não suportado neste servidor.",
        "operationId": "mcp_get",
        "responses": {
          "405": {
            "description": "Method Not Allowed - GET streaming not supported"
          }
        }
      },
      "delete": {
        "summary": "Encerrar Sessão",
        "description": "Encerra uma sessão MCP identificada pelo header Mcp-Session-Id.",
        "operationId": "mcp_delete",
        "parameters": [
          {
            "name": "Mcp-Session-Id",
            "in": "header",
            "required": true,
            "description": "ID da sessão a encerrar",
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sessão encerrada com sucesso"
          },
          "404": {
            "description": "Sessão não encontrada"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "description": "Suporta CORS preflight requests",
        "operationId": "mcp_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/health": {
      "get": {
        "summary": "Health Check",
        "description": "Verifica se o servidor está respondendo e saudável.",
        "operationId": "health_get",
        "responses": {
          "200": {
            "description": "Servidor saudável",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                },
                "example": {
                  "status": "healthy",
                  "service": "Senior Documentation MCP HTTP",
                  "version": "1.0.0",
                  "timestamp": "2026-02-05T12:34:56.789012"
                }
              }
            }
          }
        }
      }
    },
    "/openapi.json": {
      "get": {
        "summary": "OpenAPI Schema",
        "description": "Retorna esta especificação OpenAPI em formato JSON.",
        "operationId": "openapi_schema",
        "responses": {
          "200": {
            "description": "OpenAPI 3.1.0 schema"
          }
        }
      }
    },
    "/api/search": {
      "get": {
        "tags": ["REST API - Search"],
        "summary": "Pesquisar Documentação (REST)",
        "description": "Endpoint REST simples para buscar documentação. Alternativa mais fácil ao JSON-RPC para integrações com Open WebUI e ferramentas web.",
        "operationId": "api_search_get",
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": true,
            "description": "Termo(s) de busca",
            "schema": {
              "type": "string",
              "example": "configurar LSP"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "description": "Máximo de resultados (padrão: 5, máximo: 100)",
            "schema": {
              "type": "integer",
              "default": 5,
              "minimum": 1,
              "maximum": 100
            }
          },
          {
            "name": "module",
            "in": "query",
            "required": false,
            "description": "Filtrar por módulo específico (ex: 'Help Center')",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "strategy",
            "in": "query",
            "required": false,
            "description": "Estratégia de parsing: 'auto' (recomendado), 'quoted', 'and'",
            "schema": {
              "type": "string",
              "enum": ["auto", "quoted", "and"],
              "default": "auto"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Busca realizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"],
                      "description": "Status da requisição"
                    },
                    "query": {
                      "type": "string",
                      "description": "Query original"
                    },
                    "parsed_query": {
                      "type": "string",
                      "description": "Query após transformação"
                    },
                    "strategy": {
                      "type": "string",
                      "description": "Estratégia usada"
                    },
                    "module_filter": {
                      "type": ["string", "null"],
                      "description": "Filtro de módulo aplicado"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Número de resultados"
                    },
                    "results": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/DocumentResult"
                      }
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "query": "configurar LSP",
                  "parsed_query": "\"configurar LSP\"",
                  "strategy": "auto",
                  "module_filter": null,
                  "count": 3,
                  "results": [
                    {
                      "title": "Configurar LSP",
                      "url": "https://...",
                      "module": "Help Center",
                      "content": "Instruções para configurar..."
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Parâmetro 'query' obrigatório"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_search_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/modules": {
      "get": {
        "tags": ["REST API - Modules"],
        "summary": "Listar Módulos (REST)",
        "description": "Retorna lista de todos os módulos/categorias de documentação disponíveis.",
        "operationId": "api_modules_get",
        "responses": {
          "200": {
            "description": "Lista de módulos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "total_modules": {
                      "type": "integer",
                      "description": "Total de módulos"
                    },
                    "modules": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de nomes de módulos"
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "total_modules": 12,
                  "modules": [
                    "Help Center",
                    "Release Notes",
                    "API Documentation"
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_modules_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/modules/{module_name}": {
      "get": {
        "tags": ["REST API - Modules"],
        "summary": "Obter Documentos de Módulo (REST)",
        "description": "Retorna todos os documentos de um módulo específico.",
        "operationId": "api_module_docs_get",
        "parameters": [
          {
            "name": "module_name",
            "in": "path",
            "required": true,
            "description": "Nome do módulo",
            "schema": {
              "type": "string",
              "example": "Help Center"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "description": "Máximo de documentos (padrão: 20, máximo: 100)",
            "schema": {
              "type": "integer",
              "default": 20,
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Documentos do módulo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "module": {
                      "type": "string",
                      "description": "Nome do módulo"
                    },
                    "count": {
                      "type": "integer",
                      "description": "Número de documentos"
                    },
                    "docs": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/DocumentResult"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Nome do módulo inválido"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_module_docs_options",
        "parameters": [
          {
            "name": "module_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/stats": {
      "get": {
        "tags": ["REST API - Statistics"],
        "summary": "Estatísticas da Base (REST)",
        "description": "Retorna estatísticas sobre a base de documentação indexada.",
        "operationId": "api_stats_get",
        "responses": {
          "200": {
            "description": "Estatísticas da documentação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "data": {
                      "type": "object",
                      "description": "Dados estatísticos",
                      "properties": {
                        "total_documents": {
                          "type": "integer"
                        },
                        "total_modules": {
                          "type": "integer"
                        },
                        "indexed_date": {
                          "type": "string",
                          "format": "date"
                        },
                        "index_size": {
                          "type": "string",
                          "description": "Tamanho do índice em MB"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "data": {
                    "total_documents": 10456,
                    "total_modules": 12,
                    "indexed_date": "2026-02-05",
                    "index_size": "45.3 MB"
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_stats_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/api/document/{document_id}": {
      "get": {
        "tags": ["REST API - Documents"],
        "summary": "Obter Documento Completo (REST)",
        "description": "Retorna o conteúdo completo de um documento específico. Use este endpoint após uma busca inicial quando o LLM precisar de mais contexto.",
        "operationId": "api_document_get",
        "parameters": [
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "description": "ID único do documento (obtido de /api/search ou /api/modules)",
            "schema": {
              "type": "string",
              "example": "doc_12345"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Documento encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["success"]
                    },
                    "document": {
                      "$ref": "#/components/schemas/Document"
                    }
                  }
                },
                "example": {
                  "status": "success",
                  "document": {
                    "id": "doc_12345",
                    "title": "Como Configurar LSP",
                    "url": "https://docs.senior.com/...",
                    "module": "Help Center",
                    "content": "Conteúdo completo do documento...",
                    "metadata": {
                      "last_updated": "2026-02-05",
                      "word_count": 1500,
                      "author": "Senior Docs"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Documento não encontrado"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "api_document_options",
        "parameters": [
          {
            "name": "document_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/model/validate-response": {
      "post": {
        "tags": ["Model Validation"],
        "summary": "Validar Resposta do Modelo",
        "description": "Verifica se a resposta do modelo está fundamentada nas passagens/documentos recuperados. Útil para prevenir hallucinations e garantir que respostas sejam baseadas em evidências concretas.",
        "operationId": "validate_response_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateResponseRequest"
              },
              "examples": {
                "basic_validation": {
                  "summary": "Validação básica",
                  "value": {
                    "response": "O CRM Senior permite configurar notificações por email e definir regras automáticas.",
                    "retrieved_passages": [
                      {
                        "id": "doc_123",
                        "text": "O módulo CRM da Senior oferece configuração de notificações por email. Acesse Configurações > Notificações para ativar."
                      },
                      {
                        "id": "doc_124",
                        "text": "Regras automáticas podem ser definidas no CRM para automatizar processos de vendas e atendimento."
                      }
                    ],
                    "threshold": 0.75
                  }
                },
                "no_evidence": {
                  "summary": "Sem evidência",
                  "value": {
                    "response": "O CRM integra diretamente com o Salesforce.",
                    "retrieved_passages": [
                      {
                        "id": "doc_123",
                        "text": "O módulo CRM da Senior oferece configuração de notificações por email."
                      }
                    ],
                    "threshold": 0.75
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validação realizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidateResponseResult"
                },
                "examples": {
                  "verified": {
                    "summary": "Resposta verificada",
                    "value": {
                      "verified": true,
                      "evidence": [
                        {
                          "sentence": "O CRM Senior permite configurar notificações por email.",
                          "doc_id": "doc_123",
                          "passage_text": "O módulo CRM da Senior oferece configuração de notificações por email.",
                          "score": 0.92
                        }
                      ],
                      "issues": [],
                      "overall_confidence": 0.95
                    }
                  },
                  "not_verified": {
                    "summary": "Resposta não verificada",
                    "value": {
                      "verified": false,
                      "evidence": [],
                      "issues": [
                        {
                          "sentence": "O CRM integra diretamente com o Salesforce.",
                          "type": "no_evidence",
                          "details": "Nenhuma passagem similar encontrada"
                        }
                      ],
                      "overall_confidence": 0.0
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Requisição inválida - faltam parâmetros obrigatórios"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "validate_response_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/model/generate-and-validate": {
      "post": {
        "tags": ["Model Validation"],
        "summary": "Gerar e Validar Resposta",
        "description": "Endpoint completo que realiza: 1) Busca de documentos relevantes, 2) Geração de resposta usando modelo com system prompt rígido, 3) Validação automática da resposta. Retorna resposta com citações se verificada, ou mensagem padrão caso contrário.",
        "operationId": "generate_and_validate_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateAndValidateRequest"
              },
              "examples": {
                "basic_query": {
                  "summary": "Consulta básica",
                  "value": {
                    "query": "Como configurar notificações no CRM?",
                    "limit": 5,
                    "module_filter": null,
                    "generation_config": {
                      "temperature": 0.1,
                      "top_p": 0.8,
                      "max_tokens": 1000
                    },
                    "validation_threshold": 0.75
                  }
                },
                "with_module_filter": {
                  "summary": "Com filtro de módulo",
                  "value": {
                    "query": "Como gerar relatórios?",
                    "limit": 10,
                    "module_filter": "Help Center",
                    "generation_config": {
                      "temperature": 0.1,
                      "max_tokens": 800
                    },
                    "validation_threshold": 0.8
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Resposta gerada e validada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateAndValidateResult"
                },
                "examples": {
                  "success_verified": {
                    "summary": "Resposta verificada",
                    "value": {
                      "success": true,
                      "response": "Para configurar notificações no CRM, acesse Configurações > Notificações [doc_123]. Você pode ativar alertas por email [doc_123].\n\n**Fontes:**\n- [doc_123]: Configuração de Notificações CRM",
                      "verification": {
                        "verified": true,
                        "evidence": [
                          {
                            "sentence": "Para configurar notificações no CRM, acesse Configurações > Notificações.",
                            "doc_id": "doc_123",
                            "score": 0.95
                          }
                        ],
                        "issues": [],
                        "overall_confidence": 0.95
                      },
                      "retrieved_docs": [
                        {
                          "id": "doc_123",
                          "title": "Configuração de Notificações CRM",
                          "url": "https://docs.senior.com/crm/notificacoes"
                        }
                      ],
                      "metadata": {
                        "stage": "complete",
                        "verified": true
                      }
                    }
                  },
                  "no_evidence": {
                    "summary": "Sem evidência",
                    "value": {
                      "success": false,
                      "response": "Não encontrei evidência nos documentos fornecidos.",
                      "verification": {
                        "verified": false,
                        "evidence": [],
                        "issues": [],
                        "overall_confidence": 0.0
                      },
                      "retrieved_docs": [],
                      "metadata": {
                        "stage": "retrieval",
                        "reason": "no_documents_found"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Requisição inválida"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "generate_and_validate_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/mcp/validate-response": {
      "post": {
        "tags": ["MCP - Model Validation"],
        "summary": "Validar Resposta (MCP)",
        "description": "Endpoint MCP para validação de respostas. Idêntico a /model/validate-response mas seguindo convenções do namespace MCP para consistência com o protocolo.",
        "operationId": "mcp_validate_response_post",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ValidateResponseRequest"
              },
              "examples": {
                "mcp_validation": {
                  "summary": "Validação via MCP",
                  "value": {
                    "response": "O sistema permite exportar relatórios em PDF e Excel.",
                    "retrieved_passages": [
                      {
                        "id": "doc_456",
                        "text": "Relatórios podem ser exportados nos formatos PDF, Excel e CSV através do menu Exportar."
                      }
                    ],
                    "threshold": 0.75
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Validação realizada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ValidateResponseResult"
                }
              }
            }
          },
          "400": {
            "description": "Requisição inválida"
          },
          "500": {
            "description": "Erro interno do servidor"
          }
        }
      },
      "options": {
        "summary": "CORS Preflight",
        "operationId": "mcp_validate_response_options",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "JsonRpcRequest": {
        "type": "object",
        "title": "JSON-RPC 2.0 Request",
        "description": "Requisição no formato JSON-RPC 2.0 conforme https://www.jsonrpc.org/specification",
        "required": ["jsonrpc", "method", "id"],
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": ["2.0"],
            "description": "Versão JSON-RPC"
          },
          "method": {
            "type": "string",
            "description": "Método a executar: 'initialize', 'tools/list', 'tools/call'",
            "enum": ["initialize", "tools/list", "tools/call"]
          },
          "params": {
            "type": "object",
            "description": "Parâmetros do método"
          },
          "id": {
            "type": ["string", "number"],
            "description": "ID único da requisição (retornado na resposta)"
          }
        }
      },
      "JsonRpcResponse": {
        "type": "object",
        "title": "JSON-RPC 2.0 Response",
        "description": "Resposta no formato JSON-RPC 2.0",
        "required": ["jsonrpc", "id"],
        "properties": {
          "jsonrpc": {
            "type": "string",
            "enum": ["2.0"]
          },
          "id": {
            "type": ["string", "number"],
            "description": "ID da requisição correspondente"
          },
          "result": {
            "type": "object",
            "description": "Resultado da operação (se sucesso)"
          },
          "error": {
            "$ref": "#/components/schemas/JsonRpcError"
          }
        }
      },
      "JsonRpcError": {
        "type": "object",
        "title": "JSON-RPC 2.0 Error",
        "required": ["code", "message"],
        "properties": {
          "code": {
            "type": "integer",
            "description": "Código do erro JSON-RPC"
          },
          "message": {
            "type": "string",
            "description": "Mensagem de erro"
          },
          "data": {
            "type": "object",
            "description": "Dados adicionais do erro"
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "title": "Health Check Response",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["healthy"],
            "description": "Status do serviço"
          },
          "service": {
            "type": "string",
            "description": "Nome do serviço"
          },
          "version": {
            "type": "string",
            "description": "Versão do serviço"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da resposta"
          }
        }
      },
      "SearchDocsRequest": {
        "type": "object",
        "title": "Search Docs Request",
        "description": "Parâmetros para ferramenta search_docs",
        "required": ["query"],
        "properties": {
          "query": {
            "type": "string",
            "description": "Palavras-chave para busca",
            "example": "funções lsp"
          },
          "module": {
            "type": "string",
            "description": "Filtrar por módulo específico (opcional)",
            "example": "Help Center"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 5,
            "description": "Máximo de resultados a retornar"
          },
          "query_strategy": {
            "type": "string",
            "enum": ["quoted", "and", "auto"],
            "default": "auto",
            "description": "Estratégia de parsing de query:\n- 'quoted': Envolver em aspas para frase exata\n- 'and': Usar AND entre termos\n- 'auto': Inteligente (recomendado)"
          }
        }
      },
      "SearchDocsResponse": {
        "type": "object",
        "title": "Search Docs Response",
        "properties": {
          "query": {
            "type": "string",
            "description": "Query original"
          },
          "parsed_query": {
            "type": "string",
            "description": "Query após parsing"
          },
          "query_strategy": {
            "type": "string",
            "description": "Estratégia usada"
          },
          "module_filter": {
            "type": ["string", "null"],
            "description": "Filtro de módulo aplicado"
          },
          "count": {
            "type": "integer",
            "description": "Número de resultados encontrados"
          },
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Título do documento"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL do documento"
                },
                "module": {
                  "type": "string",
                  "description": "Módulo/categoria do documento"
                },
                "content": {
                  "type": "string",
                  "description": "Conteúdo resumido do documento"
                }
              }
            }
          }
        }
      },
      "Tool": {
        "type": "object",
        "title": "MCP Tool",
        "description": "Definição de uma ferramenta disponível no MCP",
        "properties": {
          "name": {
            "type": "string",
            "description": "Nome único da ferramenta"
          },
          "description": {
            "type": "string",
            "description": "Descrição do que a ferramenta faz"
          },
          "inputSchema": {
            "type": "object",
            "description": "Schema JSON dos parâmetros de entrada"
          }
        }
      },
      "DocumentResult": {
        "type": "object",
        "title": "Document Result",
        "description": "Resultado de um documento da busca",
        "properties": {
          "title": {
            "type": "string",
            "description": "Título do documento"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL do documento"
          },
          "module": {
            "type": "string",
            "description": "Módulo/categoria do documento"
          },
          "content": {
            "type": "string",
            "description": "Conteúdo resumido do documento"
          },
          "summary": {
            "type": "string",
            "description": "Resumo do documento"
          }
        }
      },
      "DocumentSummary": {
        "type": "object",
        "title": "Document Summary",
        "description": "Resumo de um documento retornado em resultados de busca. Otimizado para consumo por LLMs.",
        "required": ["id", "title", "url", "module"],
        "properties": {
          "id": {
            "type": "string",
            "description": "ID único do documento"
          },
          "title": {
            "type": "string",
            "description": "Título do documento"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL para acessar o documento completo"
          },
          "module": {
            "type": "string",
            "description": "Módulo/categoria (ex: Help Center, Release Notes)"
          },
          "summary": {
            "type": "string",
            "description": "Resumo conciso do conteúdo (primeiros 200-500 caracteres)"
          },
          "relevance_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Score de relevância da busca (0-1, onde 1 é mais relevante)"
          }
        }
      },
      "Document": {
        "type": "object",
        "title": "Complete Document",
        "description": "Documento completo com todo o conteúdo",
        "required": ["id", "title", "url", "module", "content"],
        "properties": {
          "id": {
            "type": "string",
            "description": "ID único do documento"
          },
          "title": {
            "type": "string",
            "description": "Título do documento"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL do documento original"
          },
          "module": {
            "type": "string",
            "description": "Módulo/categoria do documento"
          },
          "content": {
            "type": "string",
            "description": "Conteúdo completo do documento (em HTML ou texto plano)"
          },
          "metadata": {
            "type": "object",
            "description": "Metadados do documento",
            "properties": {
              "last_updated": {
                "type": "string",
                "format": "date",
                "description": "Data da última atualização"
              },
              "word_count": {
                "type": "integer",
                "description": "Número de palavras no documento"
              },
              "author": {
                "type": "string",
                "description": "Autor ou fonte do documento"
              }
            }
          }
        }
      },
      "SearchResult": {
        "type": "object",
        "title": "Search Result",
        "description": "Resultado estruturado de uma busca (para /api/search)",
        "required": ["status", "query", "count", "results"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["success"],
            "description": "Status da operação"
          },
          "query": {
            "type": "string",
            "description": "Query original do usuário"
          },
          "parsed_query": {
            "type": "string",
            "description": "Query após aplicação da estratégia de parsing"
          },
          "strategy": {
            "type": "string",
            "enum": ["auto", "quoted", "and"],
            "description": "Estratégia de parsing utilizada"
          },
          "module_filter": {
            "type": ["string", "null"],
            "description": "Filtro de módulo aplicado (se houver)"
          },
          "count": {
            "type": "integer",
            "description": "Número de resultados encontrados"
          },
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DocumentSummary"
            },
            "description": "Array de resumos de documentos encontrados"
          }
        }
      },
      "ModuleInfo": {
        "type": "object",
        "title": "Module Information",
        "description": "Informações sobre um módulo de documentação",
        "required": ["name", "doc_count"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Nome do módulo"
          },
          "doc_count": {
            "type": "integer",
            "description": "Número de documentos neste módulo"
          },
          "description": {
            "type": "string",
            "description": "Descrição do conteúdo do módulo (opcional)"
          }
        }
      },
      "ModuleList": {
        "type": "object",
        "title": "Module List",
        "description": "Lista de módulos disponíveis (para /api/modules)",
        "required": ["status", "total_modules", "modules"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["success"],
            "description": "Status da operação"
          },
          "total_modules": {
            "type": "integer",
            "description": "Número total de módulos"
          },
          "modules": {
            "type": "array",
            "items": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Nome do módulo"
                },
                {
                  "$ref": "#/components/schemas/ModuleInfo"
                }
              ]
            },
            "description": "Array de nomes de módulos ou objetos ModuleInfo"
          }
        }
      },
      "ValidateResponseRequest": {
        "type": "object",
        "title": "Validate Response Request",
        "description": "Requisição para validar uma resposta contra passagens recuperadas",
        "required": ["response", "retrieved_passages"],
        "properties": {
          "response": {
            "type": "string",
            "description": "Resposta gerada pelo modelo a ser validada",
            "example": "O CRM Senior permite configurar notificações automáticas por email."
          },
          "retrieved_passages": {
            "type": "array",
            "description": "Lista de passagens/documentos recuperados que devem fundamentar a resposta",
            "items": {
              "type": "object",
              "required": ["id", "text"],
              "properties": {
                "id": {
                  "type": "string",
                  "description": "ID único da passagem/documento",
                  "example": "doc_12345"
                },
                "text": {
                  "type": "string",
                  "description": "Conteúdo textual da passagem",
                  "example": "O módulo CRM oferece configuração de notificações automáticas..."
                }
              }
            },
            "minItems": 1
          },
          "threshold": {
            "type": "number",
            "description": "Limiar de similaridade para considerar uma sentença verificada (0.0 a 1.0)",
            "default": 0.75,
            "minimum": 0.0,
            "maximum": 1.0,
            "example": 0.75
          }
        }
      },
      "ValidateResponseResult": {
        "type": "object",
        "title": "Validate Response Result",
        "description": "Resultado da validação de uma resposta",
        "required": ["verified", "evidence", "issues", "overall_confidence"],
        "properties": {
          "verified": {
            "type": "boolean",
            "description": "Se a resposta foi verificada (80%+ das sentenças com evidência)",
            "example": true
          },
          "evidence": {
            "type": "array",
            "description": "Lista de evidências encontradas para sentenças verificadas",
            "items": {
              "type": "object",
              "properties": {
                "sentence": {
                  "type": "string",
                  "description": "Sentença verificada"
                },
                "doc_id": {
                  "type": "string",
                  "description": "ID do documento que suporta a sentença"
                },
                "passage_text": {
                  "type": "string",
                  "description": "Trecho da passagem que fundamenta a sentença (limitado a 200 chars)"
                },
                "score": {
                  "type": "number",
                  "description": "Score de similaridade (0.0 a 1.0)",
                  "minimum": 0.0,
                  "maximum": 1.0
                }
              }
            }
          },
          "issues": {
            "type": "array",
            "description": "Lista de problemas encontrados (sentenças não verificadas)",
            "items": {
              "type": "object",
              "properties": {
                "sentence": {
                  "type": "string",
                  "description": "Sentença com problema"
                },
                "type": {
                  "type": "string",
                  "enum": ["no_evidence", "low_confidence", "contradictory", "empty_response", "no_passages"],
                  "description": "Tipo do problema"
                },
                "details": {
                  "type": "string",
                  "description": "Detalhes sobre o problema"
                }
              }
            }
          },
          "overall_confidence": {
            "type": "number",
            "description": "Confiança geral da verificação (0.0 a 1.0). Proporção de sentenças verificadas.",
            "minimum": 0.0,
            "maximum": 1.0,
            "example": 0.95
          }
        }
      },
      "GenerateAndValidateRequest": {
        "type": "object",
        "title": "Generate and Validate Request",
        "description": "Requisição para gerar e validar uma resposta completa",
        "required": ["query"],
        "properties": {
          "query": {
            "type": "string",
            "description": "Pergunta/consulta do usuário",
            "example": "Como configurar notificações no CRM?",
            "minLength": 3
          },
          "limit": {
            "type": "integer",
            "description": "Número máximo de documentos a recuperar",
            "default": 5,
            "minimum": 1,
            "maximum": 20,
            "example": 5
          },
          "module_filter": {
            "type": ["string", "null"],
            "description": "Filtro opcional por módulo específico",
            "example": "Help Center"
          },
          "generation_config": {
            "type": "object",
            "description": "Configuração para geração da resposta",
            "properties": {
              "temperature": {
                "type": "number",
                "description": "Temperatura do modelo (0.0 = determinístico, 1.0 = criativo)",
                "default": 0.1,
                "minimum": 0.0,
                "maximum": 2.0,
                "example": 0.1
              },
              "top_p": {
                "type": "number",
                "description": "Nucleus sampling (top_p)",
                "default": 0.8,
                "minimum": 0.0,
                "maximum": 1.0,
                "example": 0.8
              },
              "max_tokens": {
                "type": "integer",
                "description": "Número máximo de tokens na resposta",
                "default": 1000,
                "minimum": 50,
                "maximum": 4000,
                "example": 1000
              }
            }
          },
          "validation_threshold": {
            "type": "number",
            "description": "Limiar para validação de sentenças",
            "default": 0.75,
            "minimum": 0.0,
            "maximum": 1.0,
            "example": 0.75
          }
        }
      },
      "GenerateAndValidateResult": {
        "type": "object",
        "title": "Generate and Validate Result",
        "description": "Resultado completo da geração e validação",
        "required": ["success", "response"],
        "properties": {
          "success": {
            "type": "boolean",
            "description": "Se o processo foi bem-sucedido e a resposta foi verificada",
            "example": true
          },
          "response": {
            "type": "string",
            "description": "Resposta gerada (com citações se verificada, ou mensagem padrão se não)",
            "example": "Para configurar notificações no CRM, acesse Configurações > Notificações [doc_123]..."
          },
          "verification": {
            "allOf": [
              {
                "$ref": "#/components/schemas/ValidateResponseResult"
              }
            ],
            "description": "Detalhes da verificação da resposta"
          },
          "retrieved_docs": {
            "type": "array",
            "description": "Documentos recuperados que foram usados",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "description": "ID do documento"
                },
                "title": {
                  "type": "string",
                  "description": "Título do documento"
                },
                "url": {
                  "type": "string",
                  "format": "uri",
                  "description": "URL do documento"
                }
              }
            }
          },
          "metadata": {
            "type": "object",
            "description": "Metadados sobre o processamento",
            "properties": {
              "stage": {
                "type": "string",
                "description": "Estágio do pipeline (retrieval, generation, validation, complete, error)",
                "example": "complete"
              },
              "verified": {
                "type": "boolean",
                "description": "Se a resposta foi verificada"
              },
              "reason": {
                "type": "string",
                "description": "Razão de falha (se success=false)"
              },
              "confidence": {
                "type": "number",
                "description": "Confiança da verificação"
              }
            }
          }
        }
      },
      "DocumentationStats": {
        "type": "object",
        "title": "Documentation Statistics",
        "description": "Estatísticas sobre a base de documentação",
        "properties": {
          "total_documents": {
            "type": "integer",
            "description": "Número total de documentos indexados"
          },
          "total_modules": {
            "type": "integer",
            "description": "Número total de módulos/categorias"
          },
          "indexed_date": {
            "type": "string",
            "format": "date",
            "description": "Data da última indexação"
          },
          "index_size": {
            "type": "string",
            "description": "Tamanho do índice (em MB ou GB)"
          },
          "languages": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Idiomas disponíveis (ex: pt-BR, en)"
          },
          "last_update": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da última atualização"
          }
        }
      }
    },
    "headers": {
      "MCP-Session-Id": {
        "schema": {
          "type": "string",
          "format": "uuid"
        },
        "description": "ID da sessão MCP (obtido em response de initialize)"
      },
      "MCP-Protocol-Version": {
        "schema": {
          "type": "string",
          "default": "2025-06-18"
        },
        "description": "Versão do protocolo MCP"
      }
    }
  },
  "tags": [
    {
      "name": "MCP Protocol",
      "description": "Operações do protocolo Model Context Protocol"
    },
    {
      "name": "Documentation Search",
      "description": "Ferramentas para busca de documentação"
    },
    {
      "name": "Health & Status",
      "description": "Health checks e status do servidor"
    },
    {
      "name": "REST API - Search",
      "description": "Endpoints REST simples para busca de documentação"
    },
    {
      "name": "REST API - Modules",
      "description": "Endpoints REST para gerenciar módulos de documentação"
    },
    {
      "name": "REST API - Statistics",
      "description": "Endpoints REST para estatísticas da base de documentação"
    },
    {
      "name": "REST API - Documents",
      "description": "Endpoints REST para recuperar documentos individuais"
    },
    {
      "name": "Model Validation",
      "description": "Endpoints para validação de respostas e prevenção de hallucinations"
    },
    {
      "name": "MCP - Model Validation",
      "description": "Endpoints MCP para validação de respostas seguindo protocolo MCP"
    }
  ]
}
