# Integração CTI

URL: https://documentacao.senior.com.br/seniorxplatform/manual-do-usuario/crmx/integracoes/senior-x/integracao-cti/integracao-cti-interno/

---

     SOLICITE UMA PROPOSTA     PORTUGUÊS     English
   Español
             
        hbspt.forms.create({
            region: "na1",
            portalId: "20786608",
            formId: "bea53a5f-6a7c-4c2b-9cab-1832bfdb85e1",
        });
            const o=document.getElementById("botao-propostas");o?.addEventListener("click",()=>{MicroModal.show("comp-modal-propostas")});const d=document.getElementById("dropdown-idiomas-botao");document.getElementById("dropdown-idiomas-topo");d?.addEventListener("click",()=>{$("#dropdown-idiomas-topo").toggle(function(){$("#dropdown-idiomas-topo").addClass("show")},function(){$("#dropdown-idiomas-topo").removeClass("show")})});   PORTAL DE DOCUMENTAÇÃO Gestão de Relacionamento | CRM X                    function m(o){gtag("event","pesquisa",{termo_pesquisado:o,origem_pesquisa:window.location.href})}const s=document.getElementById("search-form");s?.addEventListener("submit",o=>{o.preventDefault();const e=s.querySelector(".search-input"),t=e?.value;if(!t||t.trim()==="")return;const u=encodeURI(t),i=encodeURI(e.attributes.tipo.value),l=encodeURI(e.attributes.produto.value),r=encodeURI(e.attributes.versao.value),d="https://documentacao.senior.com.br/searchresults.htm";let a=`#stp=1&stq=${u}&tipo=${i}&produto=${l}`;r&&(a+=`&versao=${r}`);const n=d+a,c=document.getElementById("iframe-modal");c?(c.src=n,MicroModal.show("comp-modal-searchbox-modal"),s.querySelector("#search-submit-home-portal")!==null&&gtag("event","click",{assunto:"Home do Portal de Documentação - Botão Pesquisar no site"}),m(t)):window.open(n,"_blank")});  
     Manual do Usuário
                 > Integrações
                 > CTI
                 > Integração CTI - Configuração                         Integração CTI
Configuração
Antes de iniciar a configuração da integração com o CTI, é importante configurar a base de dados do cliente. Para isto, é necessário preencher os campos da tabela EMPRESAS:
  CampoDescrição  usa_ctiHabilita os botões de ligar no CRM  cti_autenticacaoInforma qual é a forma de autenticação do usuário no CTI (não é o socket), sendo:
CURLOPT_USERPWD $agente:$senha informações cadastradas no usuário;
token_auth: $token token no header http da requisição, informações cadastradas no usuário;
token=$token token na URL da requisição, informações cadastradas no usuário;
CURLOPT_USERPWD $agente:$senha + token_auth: $token token no header http da requisição, informações cadastradas no usuário.
  cti_tipoInforma ao ‘ModuloCti.php’ que é para gerar uma requisição do socket para o web socket, o valor tem que ser 10  cti_protocolo Informa qual é o protocolo que vai ser feito a requisição  cti_ipInforma o endereço do CTI do cliente  cti_portaInforma a porta do CTI do cliente  cti_caminhoInforma o resto do endereço da API do CTI do cliente  cti_usa_linhaNão utilizado  cti_numero_linhaNão utilizado  cti_usa_zero_dddDefine que se o valor for igual a 1 então adiciona o tom de discagem (0 zero antes do número de telefone) quando não for ramal interno  cti_nome_origemVvariável que vai na URL que diz que é o número de origem, número que tá ligando, no caso ramal que tá ligando  cti_nome_destinoVariável que vai na URL que diz que é o número de destino, número que tá recebendo  
 NotaÉ possível que os campos da tabela EMPRESAS ainda não estejam disponíveis na base do cliente.  
 Exemplo: 
Campo usa_cti: 1
Campo cti_autenticacao: 1
Campo cti_tipo: 10
Campo cti_protocolo: https
Campo cti_ip: demo…
Campo cti_porta: 8.080
Campo cti_caminho: api/clicktodial
Campo cti_usa_linha: 0
Campo cti_numero_linha: 0
Campo cti_usa_zero_ddd: 0
Campo cti_nome_origem: origem
Campo cti_nome_destino: destino
Formato da URL: $protocolo://$ip:$porta/$caminho?$nomeOrigem=$ramal&$nomeDestino=$phone$tokenUrlURL com os dados: https://demo.integracaocto.com.br:8080/api/clicktodial?origem=3501&destino=4732100123   
Como o CRM na plataforma também utilizará o Web Socket, logo são alteradas as informações da tabela ‘empresas’ para a tabela ‘configuracao_cti’. Isso significa que, os arquivos mais novos já utilizam para configurar o recebimento da ligação conforme necessidade, sem alterar código nos arquivos:
  CampoDescrição  autenticacao Informa qual é a forma de autenticação do usuário no CTI (não é o socket), sendo:            1. CURLOPT_USERPWD $agente:$senha informações cadastradas no usuário;
token_auth: $token token no header http da requisição, informações cadastradas no usuário;
token=$token token na URL da requisição, informações cadastradas no usuário;
CURLOPT_USERPWD $agente:$senha + token_auth: $token token no header http da requisição, informações cadastradas no usuário.
  tipo Informa ao ‘ModuloCti.php’ que é para gerar uma requisição do socket para o web socket, o valor tem que ser 10  protocolo Informa qual é o protocolo que vai ser feito a requisição  ip Informa o endereço do CTI do cliente  porta Informa a porta do CTI do cliente  caminho Informa o resto do endereço da API do CTI do cliente  usa_linhaNão utilizado, porém vai utilizado para dar o tom de discagem, quando 1 ativa a função  numero_linhaNão utilizado, porém será o número do tom de discagem, o valor presente será usado direto no número do telefone  metodo_chamadaInforma o método da chamada para o CTI  nome_variavel_origem_sainteVariável que vai na URL que diz que é o número de origem. Número/ramal que está ligando, no caso das ligações realizadas  nome_variavel_destino_sainteVariável que vai na URL que diz que é o número de destino. Número que está recebendo a ligação, no caso das ligações realizadas  nome_variavel_origemVariável que vai na URL que diz que é o número que está ligando, no caso das ligações recebidas  nome_variavel_destinoVariável que vai na URL que diz que é o número que está recebendo a ligação, no caso das ligações recebidas  nome_variavel_audioVariável que vai na URL que diz que é o endereço onde está disponível o áudio da ligação  
Depois de configurar o banco, devem ser substituídos os arquivos /sistema.php e /modulos/ModuloCti.php pela versão atual do sistema. Feito isso, o arquivo de /sistema.php será capaz de se conectar via protocolo WS no Web Socket, e iniciar ações, como a exibição do pop-up de inicio, recebimento e final de ligação. Ao trocar o arquivo do /modulos/ModuloCti.php, este será capaz de iniciar ligações, quando o cti_tipo for igual a 10.
Arquivos que devem ser colocados na base desse cliente na pasta /wconnect/:

WConnect_MonitoraRamal.php;
WConnect_WSDL_ConsultaRamal.php;
WConnect_WSDL_FinalizaLigacao.php;

 NotaSomente o arquivo WConnect_MonitoraRamal.php precisa ser alterado por causa dos acessos do banco de dados, ou alterar como os demais arquivos.  
Também é necessário configurar a tabela WL_chamados_empresa do banco de dados do Gestão de Relacionamento | CRM com os dados corretos do cliente em questão. Os dados do cliente a serem informados nesta tabela são: nome_banco, senha_banco e tenant.
  CampoTipo de dados  empresa_idInt  nomeVarchar  nome_bancoVarchar  senha_bancoVarchar  senha_padraoVarchar  ativoInt  versao_ambienteVarchar  data_versaoDate  hostVarchar  vipInt  tenantVarchar  curva_health_scoreVarchar  health_scoreInt  
Funcionamento da comunicação entre o CRM, Web Socket e CTI do Cliente:
                 (function(){const id = "889593262";

    var imgMod = document.getElementById(`imgmod-img-${id}`);
    imgMod.addEventListener("click", function() {
        MicroModal.show(`comp-modal-img-${id}`);
    });
})();
Ao iniciar uma ligação através do CRM são verificadas as informações do cliente e, tendo os dados de conexão com o Web Socket configurados corretamente, é enviado uma chamada para o Web Socket de início de ligação. Ao mesmo tempo completa as ações do módulo, salva os dados da ligação para histórico e exibe o pop-up p de início de ligação. Enquanto isso, o Web Scoket recebe a chamada, processa e consulta os valores, e, tendo todos os dados válidos, envia uma requisição para o CTI do cliente que inicia a ligação.
Quando a ligação encerra, o CTI do cliente envia uma requisição para o Web Scoket do CRM que, recebe a chamada, processa a requisição e consulta as informações para se conectar ao usuário. Com as informações, salva os dados da ligação para histórico e verifica se o mesmo está logado no CRM naquele momento e, caso esteja, envia a chamada para o cliente do Web Socket, que recebe a chamada e exibe o pop-up de final de ligação.       
Este artigo ajudou você?
   Sim
  Não
    
Gostaria de deixar uma sugestão para melhorar esta página?
 
Este é um espaço para sugerir melhorias no Portal de Documentação da Senior.
 
Nome/E-mail (Opcional):   
Deixe seu comentário:      Li e concordo com a Política de Privacidade da Senior, que pode usar as informações aqui fornecidas por mim para entrar em contato comigo via e-mail para ações de natureza informativa. Posso revogar meu consentimento a qualquer momento enviando um e-mail para encarregado@senior.com.br.
     Se você estiver buscando um atendimento, entre em contato com o seu canal de suporte.     SUPORTE SENIOR SUPORTE MEGA     
Agradecemos pelo seu feedback!
Vamos avaliar o comentário e alterar o conteúdo relacionado, caso seja necessário.
  const o=document.getElementById("question"),n=document.getElementById("formcomentario"),i=document.getElementById("feedback-positivo");i?.addEventListener("click",()=>{gtag("event","feedback",{resposta:"Sim"}),o.remove(),n.style.display="block"});const r=document.getElementById("feedback-negativo");r?.addEventListener("click",()=>{gtag("event","feedback",{resposta:"Não"}),o.remove(),n.style.display="block"});const d=document.getElementById("comentario"),m=document.getElementById("charNum");d.addEventListener("keyup",e=>{let t=100-e.target.value.length;m.innerHTML=`Caracteres restantes: ${t}`});n.addEventListener("submit",e=>{e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute("6Lf3rgoaAAAAAAx7d9UyE9vFrMv5p1AZdXFyUMif",{action:"submit"}).then(function(a){var t=$("#email").val(),c=$("#comentario").va